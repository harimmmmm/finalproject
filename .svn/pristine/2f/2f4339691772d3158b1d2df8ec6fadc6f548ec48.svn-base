package kr.co.itcruit.enterprise.info.controller;

import java.util.List;

import javax.inject.Inject;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;

import kr.co.itcruit.ServiceResult;
import kr.co.itcruit.enterprise.info.service.IEnterpriseInfoService;
import kr.co.itcruit.vo.EnterpriseVO;
import kr.co.itcruit.vo.ListPaginationVO;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@Controller
@RequestMapping("/ent")
public class EntRetrieveController {

	@Inject
	private IEnterpriseInfoService entService; 
	
	/**
	 * 김영상
	 * 기업정보 목록 리스트
	 * @param currentPage
	 * @param model
	 * @return
	 */
	@RequestMapping(value = "/list.do" , method = RequestMethod.GET)
	public String entList(
			@RequestParam(name="page", required = false, defaultValue = "1") int currentPage,
			Model model,
			HttpSession session,
			HttpServletRequest req
			) {
		ListPaginationVO<EnterpriseVO> pagingVO = new ListPaginationVO<EnterpriseVO>();
		
		// 현재 페이지 전달 후, start/endRow, start/endPage 설정
		pagingVO.setCurrentPage(currentPage);
		
		int totalRecord = entService.selectEntCount(pagingVO); // 총 기업 목록 수 가져오기
		
		//////// 로그 지우기
		log.info(totalRecord + "<<<<<<<<< 총 기업수");
		
		pagingVO.setTotalRecord(totalRecord);	// 총 기업 목록 수 전달 후, 총 페이지 설정 
		
		////////
		String memId = "a001";
		// 나중에는 VO 형태로 
		session.setAttribute("SessionInfo", memId);

		HttpSession IdSession = req.getSession();
		String accountId = (String) IdSession.getAttribute("SessionInfo");
		
		pagingVO.setAccountId(accountId);
		
		List<EnterpriseVO> dataList = entService.selectEntList(pagingVO);
		pagingVO.setDataList(dataList);
		

		
		model.addAttribute("pagingVO", pagingVO);
		
		return "ent/entList";
	}
	
	/**
	 * 관심등록 되있는 기업을 관심등록 삭제
	 * @param entVO
	 * @return
	 */
	@RequestMapping(value = "/likeEnt.do" , method = RequestMethod.POST)
	public ResponseEntity<String> likeEnt(@RequestBody EnterpriseVO entVO ){
		
		// accountId와 entNo를 사용하여 로직을 처리
		String memId = entVO.getAccountId();
		log.info(memId + "<<<<<<<<<<<<<<<<<<< 아이디");
		
		ServiceResult result = entService.likeEnt(entVO);	
	    
		String status = null;
		
		if(result.equals(ServiceResult.OK)) {
			status = "SUCCESS";
			return new ResponseEntity<String>(status,HttpStatus.OK);
		}else {
			status = "FAILED";
			return new ResponseEntity<String>(status,HttpStatus.FAILED_DEPENDENCY);
		}
	    
	}
	
	
	
	
	
	@RequestMapping(value = "/detail.do" , method = RequestMethod.GET)
	public String entDetail(Model model) {
		
		return "ent/entDetail";
	}
	
	
	
}
